function initailUser(){return new Vue({el:"#login-component",data:{login:{name:"",code:"",type:20},user:OsUser.userinfo},methods:{submit:function(n){var t=this;this.$validator.validateAll().then(function(i){if(i){var r=t.login;OsApi.postBtn($(n.target),"/portal/codeadminlogin",r,!0).done(function(n){n.isOK?(OsUser.UpdateUser(n.user),goTo(n.r_url?n.r_url:OsTenant.getWebRoute()+"/")):OsTips.showTipError(n.msg)})}})},send:function(n){var t=this;t.$validator.validate("name").then(function(i){if(i){var u=t.login,r=$(n.target);r.attr("disabled","disabled");r.text("发送中...");OsApi.post("/portal/sendcode",u).done(function(n){n.isOK?setTimeout(function(){t.countBack(60,r)},1e3):OsTips.showTipError(n.msg)}).always(function(n){n.isOK||(r.removeAttr("disabled"),r.text("重新尝试"))})}})},countBack:function(n,t){if(n===0)t.removeAttr("disabled"),t.text("发送");else{n-=1;t.text("("+n+")");var i=this;setTimeout(function(){i.countBack(n,t)},1e3)}}},created:function(){var n=this.login;this.$validator.extend("emailandphone",{getMessage:function(){return"手机号/邮箱必填"},validate:function(t){if(/^1\d{10}$/.test(t))n.type=20;else if(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t))n.type=30;else return!1;return!0}})}})}$(function(){initailUser()});