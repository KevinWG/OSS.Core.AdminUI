function findVersion(){return $("meta").filter(function(){var n=$(this).attr("http-equiv");return n&&n.toLowerCase()==="app-version"}).attr("content")}String.prototype.startWith=function(n){var t=new RegExp("^"+n);return t.test(this)};String.prototype.endWith=function(n){var t=new RegExp(n+"$");return t.test(this)};Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};var OsApi={isDebug:!0,postBtn:function(n,t,i){var r=n.text(),u=n.attr("loading-text");return n.attr("disabled","disabled"),n.text(u),this.post(t,i,!0).always(function(){n.text(r);n.removeAttr("disabled")}).then()},post:function(n,t,i){var r=t&&JSON.stringify(t),u={type:"POST",url:n,data:r};return this._ajax(u,i)},get:function(n,t,i){var r={type:"GET",url:n,data:t};return this._ajax(r,i)},_ajax:function(n,t){var i=$.extend({dataType:"json",contentType:"application/json; charset=utf-8"},n),r;return i.beforeSend=function(n){n.setRequestHeader("X-App-OsVer",findVersion())},i.url.indexOf("/t/")<0&&(i.url=OsTenant.getWebRoute()+i.url),t||OsTips.showLoading(),r=$.Deferred(),$.ajax(i).done(function(n,u,f){OsApi.isDebug&&(console.info("请求地址："+i.url),console.info(n));t||OsTips.hide();n.isOK=n.ret?!1:!0;n.ret===1425&&n.msg.indexOf("/")>=0?(r.reject(f,u,n),window.goTo(n.msg)):r.resolve(n)}).error(function(n,i,u){t||OsTips.hide();OsTips.showTipError("请求出错啦,网络可能出现问题");r.reject(n,i,u)}),r.promise()}},OsUtil={checkRes404:function(n){n.ret===1404&&this.go404()},go404:function(){goTo("/un/notfound")},getQuery:function(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)"),t=window.location.search.substr(1).match(i);return t&&t[2]?unescape(t[2]):null},getQueryId:function(){var n=OsUtil.getQuery("id");if(n)return n;var i=window.location.pathname,r=new RegExp("/[a-zA-Z]+/[a-zA-Z]+/(\\d+)/?$"),t=i.match(r);return t&&t.length===2&&(n=t[1]),n},getDateFromUTCSecs:function(n){return new Date(parseInt(n)*1e3)},getStateTxt:function(n){if(!n)return"正常";switch(n){case-1e3:return"已删除";case-100:return"已取消";case-10:return"失败";case 0:return"正常";case 10:return"待确认";case 20:return"通过";case 100:return"结束";default:return"未知"}},defaultVal:{img:"http://img1.s.tmxiu.cn/d/qb-default.jpg"}},OsPjaxEvents={beforeRemote:function(){},pageReplace:function(){},pageLoaded:function(){},trans:function(){},resultFilter:function(n,t,i){return typeof n=="object"||i.getResponseHeader("Content-Type").startWith("application/json")?!1:n},remoteError:function(n,t,i){var r=i.getResponseHeader("Content-Type");if(t==="error"){OsTips.showTipError("当前请求出错，请检查网络或稍后再试!");return}if(r&&r.startWith("application/json")){if(typeof n!="object"&&(n=JSON.parse(n)),n.ret===1425){window.goTo(n.msg);return}OsTips.showTipError(n.msg);return}OsTips.showTipError("当前请求超时,请稍后重试")},reset:function(){var n={beforeRemote:function(){},pageReplace:function(){},pageLoaded:function(){},trans:function(n,t,i){t.hide(400);n.fadeIn(1200,i)}};$.extend(this,n)},firstPageLoad:function(n){this.firstLoaded||(this.firstLoaded=!0,this.pageLoaded(n))}},OsPjax={instance:null,changeState:function(n,t,i){var r=this.instance.ospjax("state");t&&(r.url=t);i&&(r.title=i);this.instance.ospjax("state",n,r)},methods:{beforeRemote:function(n){OsTips.showLoading();OsPjaxEvents.beforeRemote(n)},resultFilter:OsPjaxEvents.resultFilter,remoteError:OsPjaxEvents.remoteError,beforeFormat:function(n,t){t.subcss=n.find("#oss-sub-header").remove();t.subscripts=n.find("#oss-sub-scripts").remove()},cssLoading:function(n){OsTips.hide();OsPjaxEvents.pageReplace(n);OsPjaxEvents.reset();$("#oss-header").empty().append(n.css).append(n.subcss);n.css=n.subcss=[]},scriptLoading:function(n){var t=n.content.find("template[oss-vue]").remove();$("#oss-scripts").empty().append(t);n.scripts.each(function(n,t){$("#oss-scripts").append(t)});n.subscripts.each(function(n,t){$("#oss-scripts").append(t)});n.scripts=n.subscripts=[]},trans:function(n,t,i){OsPjaxEvents.trans(n,t,i)},complete:function(n){OsTips.hide();OsPjaxEvents.pageLoaded(n)}},start:function(n){var t=this,i,r;t.instance=$(document).ospjax({wraper:"#oss-page-wraper",noQuery:t._getViewUrl,nameSpc:"oss-pjax",method:t.methods});window.goTo=function(n,i){t.instance.ospjax("goTo",{url:n,title:i})};n||(OsApi.isDebug=!1,i=OsTenant.getWebRoute()+"/home/opv",t.instance.ospjax("sysVer",{checkVer:!0,serverUrl:i}));r=t.instance.ospjax("state");OsPjaxEvents.firstPageLoad(r)},_getViewUrl:function(n){let t=n;var i=t.indexOf("?");return i>0&&(t=t.substring(0,i)),t.indexOf("/t/")<0&&(t=OsTenant.getWebRoute()+t),t}},OsTips={showTipInfo:function(n,t){t=t||5;this.showTips(n,t)},showTipError:function(n,t){t=t||6;this.showTips(n,t)},showTipSuccess:function(n,t){t=t||6;this.showTips(n,t)},showTips:function(n,t){var i,r;n&&(t=t||5,i=$("#oss-tips"),i.find(".loading").hide(),r=i.find(".text"),r.html(n),r.show(),i.show(),i.find(".container").fadeIn(300),t&&t>0&&setTimeout(function(){OsTips.hide(400)},t*1e3))},showLoading:function(){$("#oss-tips").find(".text").hide();$("#oss-tips").find(".loading").show();$("#oss-tips").show();$("#oss-tips>div").fadeIn(500)},hide:function(n){n=n||0;n===0?$("#oss-tips").hide():$("#oss-tips").fadeOut(n);$("#oss-tips>div").fadeOut(n)}},OsStorage={setLocal:function(n,t){this._set(n,t,"local")},getLocal:function(n){return this._get(n,"local")},delLocal:function(n){return this._del(n,"local")},_get:function(n,t){if(!this._checkSupport())return null;var i=t==="local"?window.localStorage.getItem(n):window.sessionStorage.getItem(n);return i&&JSON.parse(i)},_set:function(n,t,i){if(!this._checkSupport())return!1;var r=t&&JSON.stringify(t);return i==="local"?window.localStorage.setItem(n,r):window.sessionStorage.setItem(n,r),!0},_del:function(n,t){return this._checkSupport()?(t==="local"?window.localStorage.removeItem(n):window.sessionStorage.removeItem(n),!0):!1},_checkSupport:function(){return window.localStorage&&window.sessionStorage?!0:!1}};